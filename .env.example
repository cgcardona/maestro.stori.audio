# =============================================================================
# Composer Stori Audio - Environment Configuration
# =============================================================================
# Copy to .env and customize. DO NOT COMMIT .env (it is gitignored).
#
# Required for production (minimum):
#   STORI_ACCESS_TOKEN_SECRET  - JWT signing (e.g. openssl rand -hex 32)
#   STORI_DB_PASSWORD          - Postgres password (e.g. openssl rand -hex 16)
#   STORI_CORS_ORIGINS         - JSON array of exact origins (never use "*")
#   STORI_OPENROUTER_API_KEY   - Required for LLM and health if using OpenRouter
#
# Supported environments:
#   Local dev:  STORI_DOMAIN=localhost, NGINX_CONF_DIR=conf.d-local, CORS below
#   Production: Set your domain and exact CORS origins (never use "*")

# -----------------------------------------------------------------------------
# Domain and API
# -----------------------------------------------------------------------------
# Local dev: set NGINX_CONF_DIR=conf.d-local so nginx doesn't load SSL config for a specific domain
# NGINX_CONF_DIR=conf.d-local
STORI_DOMAIN=localhost
# When false, /docs and /openapi.json are disabled (recommended for stage/production)
STORI_DEBUG=false
STORI_HOST=0.0.0.0
STORI_PORT=10001

# CORS (JSON array). Required for browser/app requests. Local dev example; production: set your exact origins.
STORI_CORS_ORIGINS=["http://localhost:5173", "http://localhost:10001", "stori://"]

# -----------------------------------------------------------------------------
# Authentication (required for API access)
# -----------------------------------------------------------------------------
# Generate with: openssl rand -hex 32
STORI_ACCESS_TOKEN_SECRET=your_secret_key_here
# In-memory revocation cache TTL (seconds). Revocation visible within at most this window. Default 60.
# STORI_TOKEN_REVOCATION_CACHE_TTL_SECONDS=60

# -----------------------------------------------------------------------------
# LLM (OpenRouter recommended)
# -----------------------------------------------------------------------------
STORI_LLM_PROVIDER=openrouter
STORI_OPENROUTER_API_KEY=sk-or-v1-xxxxxxxxxxxx
STORI_LLM_MODEL=anthropic/claude-sonnet-4
# STORI_OPENROUTER_BASE_URL=https://openrouter.ai/api/v1
STORI_LLM_TIMEOUT=120
STORI_LLM_MAX_TOKENS=4096
STORI_LLM_TEMPERATURE=0.7
STORI_LLM_TOP_P=0.95

# -----------------------------------------------------------------------------
# Database (PostgreSQL in production)
# -----------------------------------------------------------------------------
# MUST set STORI_DB_PASSWORD in production (e.g. openssl rand -hex 16). Never use default.
# STORI_DATABASE_URL is built from STORI_DB_PASSWORD when using Docker Postgres.
STORI_DATABASE_URL=postgresql+asyncpg://stori:REPLACE_ME@postgres:5432/stori
STORI_DB_PASSWORD=REPLACE_ME

# -----------------------------------------------------------------------------
# Budget
# -----------------------------------------------------------------------------
STORI_DEFAULT_BUDGET_CENTS=500

# -----------------------------------------------------------------------------
# Music services (Orpheus runs in Docker; URL is internal)
# -----------------------------------------------------------------------------
# When running via docker compose, the compose file overrides this to http://orpheus:10002 so the composer container can reach Orpheus. Use localhost only when composer runs on the host.
STORI_ORPHEUS_BASE_URL=http://localhost:10002
# STORI_ORPHEUS_TIMEOUT=60
# STORI_HF_API_KEY=  # HuggingFace, for Orpheus Pro

# -----------------------------------------------------------------------------
# RAG / Qdrant (runs in Docker)
# -----------------------------------------------------------------------------
# STORI_QDRANT_HOST=qdrant
# STORI_QDRANT_PORT=6333
# RAG embeddings use HuggingFace (STORI_HF_API_KEY) via scripts/ingest_docs.py

# -----------------------------------------------------------------------------
# AWS S3 asset delivery (drum kits, soundfont)
# -----------------------------------------------------------------------------
# Set via deploy/setup-s3-assets.sh output. Leave unset to disable.
# STORI_AWS_S3_ASSET_BUCKET=stori-assets
# STORI_AWS_REGION=us-east-1
# Presigned URL expiry (seconds); default 1800 = 30 min
# STORI_PRESIGN_EXPIRY_SECONDS=1800
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
# Optional: author/license for upload scripts (upload_assets_to_s3.py, upload_placeholder_kits.py)
# STORI_ASSET_AUTHOR=Stori Composer
# STORI_ASSET_LICENSE=CC0

# -----------------------------------------------------------------------------
# Orchestration (EDITING loop; optional overrides)
# -----------------------------------------------------------------------------
# STORI_ORCHESTRATION_MAX_ITERATIONS=10
# STORI_ORCHESTRATION_TEMPERATURE=0.1

# -----------------------------------------------------------------------------
# MCP stdio server (optional; for Cursor/Claude Desktop proxying to this backend)
# -----------------------------------------------------------------------------
# When set, stdio MCP forwards DAW tool calls to the Composer URL with this token.
# STORI_COMPOSER_MCP_URL=http://localhost:10001
# STORI_MCP_TOKEN=

# -----------------------------------------------------------------------------
# Deploy / SSL (used by deploy scripts)
# -----------------------------------------------------------------------------
# CERTBOT_EMAIL=admin@example.com
