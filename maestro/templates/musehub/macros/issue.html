{# macros/issue.html — reusable issue row building block.
   Import with:
     {% from "musehub/macros/issue.html" import issue_row %}
   Then call:
     {{ issue_row(issue, base_url=base_url) }}
   Optional kwargs:
     labels        — list of label dicts (each with .name / .color) for colour lookup
     active_labels — list of label name strings currently filtering the view
     show_checkbox — True to render a selection checkbox (e.g. bulk-action views)
#}

{% macro issue_row(issue, base_url, labels=[], active_labels=[], show_checkbox=False) %}
<div class="issue-row" data-issue-id="{{ issue.issue_id }}">
  {% if show_checkbox %}
    <input type="checkbox" class="issue-row-check" name="selected" value="{{ issue.issue_id }}"
           onchange="toggleIssueSelect('{{ issue.issue_id }}', this.checked)"/>
  {% endif %}
  <span class="badge badge-{{ issue.state }}">#{{ issue.number }}</span>
  <div style="flex:1;min-width:0">
    <a href="{{ base_url }}/issues/{{ issue.number }}">{{ issue.title }}</a>
    <div class="issue-meta">
      {% for label in issue.labels %}
        {% set label_obj = labels | selectattr('name', 'equalto', label) | first | default(None) %}
        {% set color = label_obj.color if label_obj else '#8b949e' %}
        <span class="label label-pill{% if label in active_labels %} label-active{% endif %}"
              style="border-color:{{ color }};color:{{ color }}">{{ label }}</span>
      {% endfor %}
      <span class="issue-date">Opened {{ issue.created_at | fmtdate }}</span>
      {% if issue.author %}<span class="issue-author">by {{ issue.author }}</span>{% endif %}
    </div>
  </div>
  <span class="badge badge-{{ issue.state }}">{{ issue.state }}</span>
</div>
{% endmacro %}
