<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/musehub/static/tokens.css">
  <link rel="stylesheet" href="/musehub/static/components.css">
  <link rel="stylesheet" href="/musehub/static/layout.css">
  <link rel="stylesheet" href="/musehub/static/icons.css">
  <link rel="stylesheet" href="/musehub/static/music.css">
  <title>{% block title %}Muse Hub{% endblock %} — Muse Hub</title>
  {% block extra_css %}{% endblock %}
</head>
<body>
  <header>
    <span class="logo"><a href="/musehub/ui/explore" style="color:inherit;text-decoration:none">&#127925; Muse Hub</a></span>
    <span class="breadcrumb">{% block breadcrumb %}{% endblock %}</span>
    <span class="spacer"></span>
    {% block header_actions %}
    <a href="/musehub/ui/explore" class="btn btn-ghost btn-sm" style="font-size:12px">Explore</a>
    <a href="/musehub/ui/search" class="btn btn-ghost btn-sm" style="font-size:12px">Search</a>
    <button id="signout-btn" class="btn btn-secondary btn-sm" style="font-size:12px;display:none"
            onclick="clearToken();location.reload()">Sign out</button>
    {% endblock %}
  </header>

  {# Repo-scoped pages fill this with the header card + tab strip #}
  {% block repo_nav %}{% endblock %}

  <div class="container{% block container_extra_class %}{% endblock %}"{% block container_attrs %}{% endblock %}>
    {% block token_form %}
    <div class="token-form" id="token-form" style="display:none">
      <p id="token-msg">Enter your Maestro JWT to browse this repo.</p>
      <input type="password" id="token-input" placeholder="eyJ..." />
      <button class="btn btn-primary" onclick="saveToken()">Save &amp; Load</button>
      &nbsp;
      <button class="btn btn-secondary" onclick="clearToken();location.reload()">Clear</button>
    </div>
    {% endblock %}
    <div id="content"><p class="loading">Loading&#8230;</p></div>
  </div>

  {% block body_extra %}{% endblock %}

  {# Persistent floating audio player — hidden until audio is queued #}
  <div class="audio-player" id="audio-player" style="display:none">
    <button class="player-btn" id="player-toggle" onclick="togglePlay()">&#9654;</button>
    <div class="player-info">
      <span class="player-title" id="player-title">Now Playing</span>
      <span class="player-repo" id="player-repo"></span>
    </div>
    <div class="player-progress">
      <span class="player-time" id="player-current">0:00</span>
      <input type="range" class="player-seek" id="player-seek" value="0" min="0" max="100" step="0.1"
             oninput="seekAudio(this.value)" />
      <span class="player-time" id="player-duration">0:00</span>
    </div>
    <audio id="player-audio" onended="onAudioEnded()" ontimeupdate="onTimeUpdate()"
           onloadedmetadata="onMetadata()"></audio>
    <button class="player-btn" onclick="closePlayer()" title="Close">&#10005;</button>
  </div>

  <script src="/musehub/static/musehub.js"></script>
  <script>
    window.addEventListener('DOMContentLoaded', function() {
      // Show Sign out only when a token is stored.
      if (getToken()) {
        var btn = document.getElementById('signout-btn');
        if (btn) btn.style.display = '';
      }
      {% block page_data %}{% endblock %}
      {% block page_script %}{% endblock %}
    });
  </script>
</body>
</html>
