{#
  Fragment: repo list for a single topic detail page.

  Context variables (supplied by topic_detail_page() via htmx_fragment_or_full):
    tag           â€” str: the tag slug being viewed
    repos         â€” list[ExploreRepoResult]: paginated repos for this tag
    total         â€” int: total matching repos
    total_pages   â€” int: number of pages
    page          â€” int: current 1-based page number
    page_size     â€” int: repos per page
    sort          â€” str: current sort ('stars' | 'updated')

  Returned standalone for HX-Request: true (HTMX partial swap â€” sort/pagination).
  Included directly by pages/topics.html for full-page renders.
#}
<div id="topic-repos">
  <div style="display:flex;align-items:center;justify-content:space-between;
              margin-bottom:12px;flex-wrap:wrap;gap:8px">
    <h2 style="font-size:15px;margin:0;color:var(--text-muted,#8b949e);
               text-transform:uppercase;letter-spacing:0.5px;font-weight:600">
      All Repositories
    </h2>
    <div style="display:flex;gap:6px;align-items:center">
      <span style="font-size:13px;color:var(--text-muted,#8b949e)">Sort:</span>
      <a href="/musehub/ui/topics/{{ tag | urlencode }}?sort=stars&amp;page=1"
         class="btn {{ 'btn-primary' if sort == 'stars' else 'btn-secondary' }}"
         style="font-size:12px;padding:4px 10px">Most starred</a>
      <a href="/musehub/ui/topics/{{ tag | urlencode }}?sort=updated&amp;page=1"
         class="btn {{ 'btn-primary' if sort == 'updated' else 'btn-secondary' }}"
         style="font-size:12px;padding:4px 10px">Recently updated</a>
    </div>
  </div>

  {% if not repos %}
    <p style="color:var(--text-muted,#8b949e)">
      No public repositories tagged with <strong>#{{ tag }}</strong> yet.
    </p>
  {% else %}
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:12px">
      {% for repo in repos %}
        <div class="card repo-card">
          <div>
            <a href="/musehub/ui/{{ repo.owner }}/{{ repo.slug }}"
               style="font-weight:600;font-size:15px">{{ repo.owner }}/{{ repo.name }}</a>
          </div>
          {% if repo.description %}
            <p style="font-size:13px;color:var(--text-muted,#8b949e);margin:0">
              {{ repo.description }}
            </p>
          {% endif %}
          <div>
            {% for t in repo.tags[:4] %}
              <a href="/musehub/ui/topics/{{ t | urlencode }}" class="tag-badge">#{{ t }}</a>
            {% endfor %}
          </div>
          <div style="display:flex;gap:12px;font-size:12px;color:var(--text-muted,#8b949e);margin-top:2px">
            <span>â­ {{ repo.star_count }}</span>
            {% if repo.key_signature %}<span>ğŸµ {{ repo.key_signature }}</span>{% endif %}
            {% if repo.tempo_bpm %}<span>â™© {{ repo.tempo_bpm }} BPM</span>{% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  {# Pagination #}
  {% if total_pages > 1 %}
    <div style="display:flex;gap:8px;justify-content:center;margin-top:16px">
      {% if page > 1 %}
        <a href="/musehub/ui/topics/{{ tag | urlencode }}?sort={{ sort }}&amp;page={{ page - 1 }}"
           class="btn btn-secondary">&larr; Prev</a>
      {% endif %}
      <span style="padding:6px 12px;font-size:13px;color:var(--text-muted,#8b949e)">
        Page {{ page }} of {{ total_pages }}
      </span>
      {% if page < total_pages %}
        <a href="/musehub/ui/topics/{{ tag | urlencode }}?sort={{ sort }}&amp;page={{ page + 1 }}"
           class="btn btn-secondary">Next &rarr;</a>
      {% endif %}
    </div>
  {% endif %}
</div>
