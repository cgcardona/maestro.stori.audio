{% extends "musehub/base.html" %}

{% block title %}Milestones â€” {{ owner }}/{{ repo_slug }}{% endblock %}
{% block breadcrumb %}
  <a href="/musehub/ui/{{ owner }}">{{ owner }}</a> /
  <a href="/musehub/ui/{{ owner }}/{{ repo_slug }}">{{ repo_slug }}</a> / milestones
{% endblock %}
{% block repo_nav %}{% include "musehub/partials/repo_nav.html" %}{% endblock %}

{% block extra_css %}
<style>
/* â”€â”€ Milestone list layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.milestone-toolbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: var(--space-3, 12px);
  margin-bottom: var(--space-3, 12px);
}
.milestone-toolbar h1 { margin: 0; }

/* State tabs */
.milestone-state-tabs {
  display: flex;
  gap: var(--space-1, 4px);
  border-bottom: 1px solid var(--border, #30363d);
  margin-bottom: var(--space-3, 12px);
}
.milestone-tab {
  padding: 6px 14px;
  font-size: 13px;
  font-weight: 500;
  color: var(--text-muted, #8b949e);
  text-decoration: none;
  border-bottom: 2px solid transparent;
  margin-bottom: -1px;
}
.milestone-tab:hover { color: var(--text-primary, #e6edf3); }
.milestone-tab.tab-active {
  color: var(--text-primary, #e6edf3);
  border-bottom-color: var(--accent, #58a6ff);
}

/* Sort form */
.milestone-sort-form {
  display: flex;
  align-items: center;
  gap: var(--space-2, 8px);
  font-size: 13px;
  color: var(--text-muted, #8b949e);
  margin-bottom: var(--space-3, 12px);
}
.sort-btn {
  padding: 4px 10px;
  border-radius: 6px;
  border: 1px solid var(--border, #30363d);
  background: var(--bg-overlay, #161b22);
  color: var(--text-secondary, #c9d1d9);
  font-size: 12px;
  cursor: pointer;
}
.sort-btn.sort-active {
  border-color: var(--accent, #58a6ff);
  color: var(--accent, #58a6ff);
}
.sort-btn:hover { border-color: var(--accent, #58a6ff); }

/* Milestone rows */
.milestone-row {
  padding: 16px 0;
  border-bottom: 1px solid var(--border, #30363d);
}
.milestone-row:last-child { border-bottom: none; }

.milestone-title-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 6px;
  flex-wrap: wrap;
}
.milestone-title-link {
  font-weight: 600;
  font-size: 15px;
}
.milestone-meta {
  font-size: 12px;
  color: var(--text-muted, #8b949e);
  margin-bottom: 6px;
}
.milestone-due { color: var(--text-muted, #8b949e); }

/* Progress bar */
.milestone-progress-wrap {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}
.milestone-progress-bar-track {
  width: 100%;
  max-width: 300px;
  height: 8px;
  border-radius: 4px;
  background: var(--bg-overlay, #161b22);
  border: 1px solid var(--border, #30363d);
  overflow: hidden;
}
.milestone-progress-bar-fill {
  height: 100%;
  border-radius: 4px;
  background: var(--green, #3fb950);
}
.milestone-progress-label {
  font-size: 12px;
  color: var(--text-muted, #8b949e);
  white-space: nowrap;
}

.milestone-empty {
  padding: 24px 0;
  color: var(--text-muted, #8b949e);
  text-align: center;
}
</style>
{% endblock %}

{% block page_data %}
const repoId  = {{ repo_id | tojson }};
const base    = {{ base_url | tojson }};
{% endblock %}

{% block page_script %}
{% raw %}
initRepoNav(repoId);
{% endraw %}
{% endblock %}

{% block content %}
<div class="card">
  <div class="milestone-toolbar">
    <h1>ğŸ Milestones</h1>
    <span style="font-size:13px;color:var(--text-muted,#8b949e)">
      {{ open_count }} open &bull; {{ closed_count }} closed
    </span>
  </div>

  {# State tabs #}
  <div class="milestone-state-tabs">
    {% for s, label in [('open', 'Open'), ('closed', 'Closed'), ('all', 'All')] %}
    <a href="{{ base_url }}/milestones?state={{ s }}&sort={{ sort }}"
       class="milestone-tab{% if state == s %} tab-active{% endif %}"
       hx-get="{{ base_url }}/milestones?state={{ s }}&sort={{ sort }}"
       hx-target="#milestone-rows"
       hx-push-url="true">
      {{ label }}
    </a>
    {% endfor %}
  </div>

  {# Sort controls #}
  <form method="get" class="milestone-sort-form"
        hx-get="{{ base_url }}/milestones"
        hx-target="#milestone-rows"
        hx-push-url="true">
    <input type="hidden" name="state" value="{{ state }}"/>
    <span>Sort by:</span>
    {% for val, lbl in [('due_on', 'Due date'), ('title', 'Title'), ('completeness', 'Completeness')] %}
    <button type="submit" name="sort" value="{{ val }}"
            class="sort-btn{% if sort == val %} sort-active{% endif %}">{{ lbl }}</button>
    {% endfor %}
  </form>

  <div id="milestone-rows">
    {% include "musehub/fragments/milestone_rows.html" %}
  </div>
</div>
{% endblock %}
