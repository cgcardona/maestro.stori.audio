# docker-compose.override.yml — local development only
#
# Auto-merged by `docker compose up` (no -f flag needed).
# Production: `docker compose -f docker-compose.yml up` skips this file.
#
# ┌─────────────────────────────────────────────────────────────────────┐
# │  REBUILD GUIDE — when do you need `docker compose build <service>`? │
# ├─────────────────────────────────────────────────────────────────────┤
# │  REBUILD REQUIRED          │  NO REBUILD — live via bind-mount      │
# ├────────────────────────────┼────────────────────────────────────────┤
# │  requirements.txt changed  │  maestro/**/*.py                       │
# │  Dockerfile changed        │  tests/**/*.py                         │
# │  New top-level dir added   │  scripts/**                            │
# │  (not yet in volumes below)│  alembic/**                            │
# │                            │  /worktrees/<id>/**  (worktrees)       │
# │                            │  tourdeforce/**                  │
# │                            │  tools/**                              │
# │                            │  pyproject.toml                        │
# │                            │  storpheus/**/*.py                     │
# └────────────────────────────┴────────────────────────────────────────┘
#
# Bind-mounts shadow the COPY'd code in the image — host edits are
# immediately visible inside the container with zero restart needed.
# The baked image layer only matters for dependencies (wheels/pip installs).

services:
  maestro:
    volumes:
      - maestro_data:/data
      - ./maestro:/app/maestro
      - ./tests:/app/tests
      - ./scripts:/app/scripts
      - ./tools:/app/tools
      - ./alembic:/app/alembic
      - ./tourdeforce:/app/tourdeforce
      - ./pyproject.toml:/app/pyproject.toml
      # Cursor worktrees — agents run mypy/pytest directly against their worktree
      # via PYTHONPATH=/worktrees/<id>. No file copies needed. See .cursor/PARALLEL_ISSUE_TO_PR.md.
      - /Users/gabriel/.cursor/worktrees/maestro:/worktrees

  storpheus:
    volumes:
      - storpheus_cache:/data/cache
      - ./storpheus:/app
